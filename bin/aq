#!/usr/bin/env bash

function by_id {
  local a
  local count=0
  for a in "$@"; do
    if [[ "$count" -gt 0 ]]; then
      printf ' | '
    fi
    printf 'aws_attrs(.%s)' "$a"
    count="$((count + 1))"
  done
}

function id_table {
  case "${1:-}-${2:-}" in
    ec2-describe-instances)
      echo ReservationId InstanceId GroupName PrivateIpAddress Ipv6Address DeviceName ;;
    ec2-describe-regions)
      echo RegionName ;;
    ec2-describe-availability-zones)
      echo ZoneName ;;
    ec2-describe-volumes)
      echo Device VolumeId ;;
    ec2-describe-snapshots)
      echo SnapshotId ;;
    ec2-describe-vpcs)
      echo VpcId AssociationId ;;
    *)
      echo Whatever ;;
  esac
}

function jqid {
  jq "$(by_id $(id_table "$@"))"
}

function main {
  local shome="$(cd -P -- "${BASH_SOURCE%/*}/.." && pwd -P)"
  source "${BLOCK_PATH:-"$shome/work"}/block/script/profile" ~
  source normalize  

  aws "$@" | jq 'aws_attrs(.ResourceId) | aws_tags' | jqid "$@"
}

source sub "$BASH_SOURCE" "$@"
